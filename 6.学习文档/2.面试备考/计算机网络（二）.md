# 计算机网络（二）

## **0.浏览器中输入URL到返回页面的全过程？**

- 1.根据域名，进行DNS域名解析；
- 2.拿到解析的IP地址，建立TCP连接；
- 3.向IP地址，发送HTTP请求；
- 4.服务器处理请求；
- 5.返回响应结果；
- 6.关闭TCP连接；
- 7.浏览器解析HTML；
- 8.浏览器布局渲染；

## 1.什么是域名系统协议（DNS协议）

* **为什么需要DNS协议？而不直接使用IP地址？**

  *  因为IP地址是固定长度的，IPv4是32位，IPv6是128位，而域名是变长的，不便于计算机处理。

  * 网络通讯大部分是基于TCP/IP的，而TCP/IP是基于IP地址的，所以计算机在网络上进行通讯时只能识别如“202.96.134.133”之类的IP地址，而不能认识域名。 IP地址对于用户来说不方便记忆，但域名便于用户使用，例如www.baidu.com这是百度的域名。所以我们访问网站时，更多的是在浏览器地址栏中输入域名，就能看到所需要的页面，因为有一个叫“DNS服务器”的计算机自动把我们的域名“翻译”成了相应的IP地址，然后调出IP地址所对应的网页。

* **什么是dns？**

> **域名系统**（Domain Name System，缩写：DNS）是一种组织成域层次结构的计算机和网络服务命名系统，它用于TCP/IP网络，它所提供的服务是用来将主机名和域名转换为IP地址的工作。它作为将域名和IP地址相互映射的一个**分布式**数据库，能够使人更方便地访问互联网。

* **DNS为什么不采用单点的集中式的设计方式，而是使用分布式集群的工作方式？**

  DNS的一种简单的设计模式就是在因特网上只使用一个DNS服务器，该服务器包含所有的映射，在这种集中式的设计中，客户机直接将所有查询请求发往单一的DNS服务器，同时该DNS服务器直接对所有查询客户机做出响应，尽管这种设计方式非常诱人，但他不适用当前的互联网，因为当今的因特网有着数量巨大并且在持续增长的主机，这种集中式设计会有**单点故障**（嗝屁一个，全球着急），**通信容量**（上亿台主机发送的查询DNS报文请求，包括但不限于所有的HTTP请求，电子邮件报文服务器，TCP长连接服务），**远距离的时间延迟**（澳大利亚到纽约的举例），**维护开销大**（因为所有的主机名-ip映射都要在一个服务站点更新）等问题

* **DNS 解析的过程？**

  关于DNS的获取流程：
  DNS是应用层协议，事实上他是为其他应用层协议工作的，包括不限于HTTP和SMTP以及FTP，用于将用户提供的主机名解析为ip地址。
  具体过程如下：

  ①用户主机上运行着DNS的客户端
  ②从浏览器将接收到的url中抽取出域名字段，就是访问的主机名，比如

  ```text
  http://www.baidu.com/
  ```

  , 并将这个主机名传送给DNS应用的客户端
  ③DNS客户机端向DNS服务器端发送一份查询报文，报文中包含着要访问的主机名字段（中间包括一些列缓存查询以及分布式DNS集群的工作）
  ④该DNS客户机最终会收到一份回答报文，其中包含有该主机名对应的IP地址。

  > 所有DNS请求和回答报文使用的UDP数据报经过端口53发送

  * **说说UDP协议在哪里使用，TCP协议在哪里使用？**

    域名解析用udp，tcp协议用在区域传送

    DNS的规范规定了2种类型的DNS服务器，一个叫主DNS服务器，一个叫辅助DNS服务器。在一个区中主DNS服务器从自己本机的数据文件中读取该区的DNS数据信息，而辅助DNS服务器则从区的主DNS服务器中读取该区的DNS数据信息。当一个辅助DNS服务器启动时，它需要与主DNS服务器通信，并加载数据信息，这就叫做区传送（zone transfer）。 这种情况下，使用TCP协议。

  * **DNS在域名解析上用udp还是TCP协议？**

    域名解析一般用udp。

    * **讲讲域名解析为什么用UDP？**

      因为UDP快啊！UDP的DNS协议只要一个请求、一个应答就好了。而使用基于TCP的DNS协议要三次握手、发送数据以及应答、四次挥手。但是UDP协议传输内容不能超过512字节。不过客户端向DNS服务器查询域名，一般返回的内容都不超过512字节，用UDP传输即可。

    * **讲讲区域传送为什么用TCP？**

      因为TCP协议可靠性好啊！你要从主DNS上复制内容啊，你用不可靠的UDP？ 因为TCP协议传输的内容大啊，你用最大只能传512字节的UDP协议？万一同步的数据大于512字节，你怎么办？

* **DNS 查询的过程？**

  查询内容。 DNS的查询参数一般有三个

  - (1)域名:服务器、邮件服务器(邮件地址中 @ 后面的部分)的名称
  - (2)Class:在设置DNS方案时，互联网之外的网络也考虑到了，而Class就是用来识别网络的，不过现在只有互联网，所以它的值永远都是代表互联网的IN
  - (3)记录类型:标识域名对应何种类型的记录。类型为A,表示域名对应的IP地址。类型为MX时,表示域名对应的是邮件服务器。类型为PTR,表示根据IP地址反查域名。类型为CNAME,表示查询域名相关别名。

* **DNS是怎么做域名解析的？**

  * 域名结构：

    `www.tmall.com`对应的真正的域名为`www.tmall.com.`。末尾的`.`称为根域名，因为每个域名都有根域名，因此我们通常省略。

    根域名的下一级，叫做"顶级域名"（top-level domain，缩写为TLD），比如`.com、.net`；

    再下一级叫做"次级域名"（second-level domain，缩写为SLD），比如`www.tmall.com`里面的`.tmall`，这一级域名是用户可以注册的；

    再下一级是主机名（host），比如`www.tmall.com`里面的`www`，又称为"三级域名"，这是用户在自己的域里面为服务器分配的名称，是用户可以任意分配的。

  * 解析流程本质上是**分级查询**

    DNS服务器一般分三种，根DNS服务器，顶级DNS服务器，权威DNS服务器。

    1、在浏览器中输入www  . qq  .com 域名，操作系统会先检查自己本地的hosts文件是否有这个网址映射关系，如果有，就先调用这个IP地址映射，完成域名解析。 

    2、如果hosts里没有这个域名的映射，则查找本地DNS解析器缓存，是否有这个网址映射关系，如果有，直接返回，完成域名解析。 

    3、如果hosts与本地DNS解析器缓存都没有相应的网址映射关系，首先会找TCP/ip参数中设置的首选DNS服务器，在此我们叫它本地DNS服务器，此服务器收到查询时，如果要查询的域名，包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析，此解析具有权威性。 

    4、如果要查询的域名，不由本地DNS服务器区域解析，但该服务器已缓存了此网址映射关系，则调用这个IP地址映射，完成域名解析，此解析不具有权威性。 

    5、如果本地DNS服务器本地区域文件与缓存解析都失效，则根据本地DNS服务器的设置（是否设置转发器）进行查询，如果未用转发模式，本地DNS就把请求发至13台根DNS，根DNS服务器收到请求后会判断这个域名(.com)是谁来授权管理，并会返回一个负责该顶级域名服务器的一个IP。本地DNS服务器收到IP信息后，将会联系负责.com域的这台服务器。这台负责.com域的服务器收到请求后，如果自己无法解析，它就会找一个管理.com域的下一级DNS服务器地址([http://qq.com](https://link.zhihu.com/?target=http%3A//qq.com))给本地DNS服务器。当本地DNS服务器收到这个地址后，就会找[http://qq.com](https://link.zhihu.com/?target=http%3A//qq.com)域服务器，重复上面的动作，进行查询，直至找到www  . qq  .com主机。 

    6、如果用的是转发模式，此DNS服务器就会把请求转发至上一级DNS服务器，由上一级服务器进行解析，上一级服务器如果不能解析，或找根DNS或把转请求转至上上级，以此循环。不管是本地DNS服务器用是是转发，还是根提示，最后都是把结果返回给本地DNS服务器，由此DNS服务器再返回给客户机。 

    ​    从客户端到本地DNS服务器是属于递归查询，而DNS服务器之间就是的交互查询就是迭代查询。

## 2.什么是文件传送协议（FTP协议)

* **什么是FTP协议？**

  文件传输协议（File Transfer Protocol，FTP）是用于在[网络](https://baike.baidu.com/item/网络)上进行文件传输的一套标准协议，它工作在 OSI 模型的第七层， TCP 模型的第四层， 即应用层。FTP允许用户以文件操作的方式（如文件的增、删、改、查、传送等）与另一主机相互通信。然而， 用户并不真正登录到自己想要存取的计算机上面而成为完全用户， 可用FTP程序访问远程资源， 实现用户往返传输文件、目录管理以及访问电子邮件等等， 即使双方计算机可能配有不同的操作系统和文件存储方式。 

* **FTP的两种连接**

  FTP是基于TCP的传输，FTP采用双TCP连接方式；支持授权与认证机制，提供目录列表功能

  两个连接分别为：

  控制连接：控制连接使用TCP端口号21；用于在FTP客户端和FTP服务器之间传输FTP控制命令及命令执行信息；控制连接在整个FTP会话期间一直保持打开。
  数据连接：数据连接使用TCP端口号（主动模式下20，被动模式下随机）；用于传输数据，包括数据上传、下载、文件列表发送等。数据传输结束后数据连接将终止

* **FTP传输模式：**ASCII模式和二进制模式

  ASCII模式用于传输文本。发送端的字符在发送前被转换成ASCII码格式之后进行传输，接收端收到之后再将其转换成字符。

  二进制模式常用于发送图片文件和程序文件。发送端在发送这些文件时无需转换格式，即可传输

* **FTP采用两种数据传输方式：**主动模式和被动模式

  * 主动方式也称为PORT方式，是FTP协议最初定义的数据传输连接方式，主要特点是:

    1、FTP客户端通过向FTP服务器发送PORT命令，告诉服务器该客户端用于传输数据的临时端口号

    2、当需要传送数据时，服务器通过TCP端口号20与客户端的临时端口建立数据传输通道，完成数据传输；在建立数据连接的过程中，由服务器主动发起连接，因此被称为主动方式；具体交互过程如下：

    * 通过TCP三次握手建立控制连接
    * 客户端使用PORT命令通告用于数据传输的临时端口号20
    * 通过TCP三次握手建立数据连接
    * 双方进行数据传输，传送完毕后发送数据的一方主动关闭连接

  * 被动方式也称为PASV方式，被动方式的主要特点是:

    1、FTP客户端通过向FTP服务器发送PASV命令，告诉服务器进入被动方式。服务器选择临时端口号并告知客户端

    2、当需要传送数据时，客户端主动与服务器的临时端口号建立数据传输通道，完成数据传输；在整个过程中，由于服务器总是被动接收客户端的数据连接，因此被称为被动方式；具体交互过程如下：

    * 通过TCP三次握手建立控制连接
    * 服务端对PASV命令回应，其中包含用于数据传输的临时端口号（随机选择）
    * 通过TCP三次握手建立控制连接
    * 双方进行数据传输，传送完毕后发送数据的一方主动关闭连接

* **安全性**

  主动模式要求客户端开放端口号给服务器端，需要去配置客户端的防火墙。

  被动模式只需要服务器端开放端口号即可，无需客户端配置防火墙。但是被动模式会导致服务器端的安全性减弱，因为开放了过多的端口号。

## 3.什么是动态主机配置协议（DHCP协议）

* **介绍DHCP**

  动态主机设置协议（Dynamic Host Configuration Protocol, DHCP）是一个[局域网](https://link.zhihu.com/?target=http%3A//zh.wikipedia.org/wiki/%E5%B1%80%E5%9F%9F%E7%BD%91)的[网络协议](https://link.zhihu.com/?target=http%3A//zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE)，使用[UDP](https://link.zhihu.com/?target=http%3A//zh.wikipedia.org/wiki/UDP)协议工作，主要有两个用途：

  - 给内部网络或网络服务供应商自动分配[IP](https://link.zhihu.com/?target=http%3A//zh.wikipedia.org/wiki/IP)地址给用户
  - 给内部网络管理员作为对所有电脑作中央管理的手段

  DHCP协议支持C/S（客户端/服务器）结构

  * DHCP客户端：通常为网络中的PC、打印机等终端设备，使用从DHCP服务器分配下来的IP信息，包括IP地址、DNS等。
  * DHCP服务器：所有的IP网络设定信息都由DHCP服务器集中管理，并处理客户端的DHCP请求。
  * DHCP采用UDP作为传输协议，客户端发送消息到DHCP服务器的的67号端口，服务器返回消息给客户端的68号端口。

* **为什么使用 DHCP？**

  * 在常见的小型网络中（例如家庭网络和学生宿舍网），网络管理员都是采用手工分配IP地址的方法，而到了中、大型网络，这种方法就不太适用了。在中、大型网络，特别是大型网络中，往往有超过100台的客户机，手动分配IP地址的方法就不太合适了。因此，我们必须引入一种高效的IP地址分配方法。
  * 可靠的 IP 地址配置。 DHCP 最大程度地减少了由手动 IP 地址配置（如录入错误）导致的配置错误。而且降低了网络管理。 

* **IP地址分配方式**

  * 人工配置：由管理员对每台具体的计算机指定一个地址
  * 自动配置：服务器为第一次连接网络的计算机分配一个永久地址
  * 动态配置：在一定的期限内将地址租给计算机，路由器经常使用的地址分配方式是动态配置

* **DHCP工作流程**

1. 发现阶段，即DHCP客户机寻找DHCP服务器的阶段。DHCP客户机以广播方式发送DHCP discover发现信息来寻找DHCP服务器。
2. 提供阶段，即DHCP服务器提供IP地址的阶段。DHCP服务器在网络中接收到信息后会做出响应，它从尚未出租的IP地址中挑选一个分配给DHCP客户机，向DHCP客户机发送一个包含出租的IP地址和其他设置的DHCP offer提供信息。
3. 选择阶段，即DHCP客户机选择某台DHCP服务器提供的IP地址的阶段。如果有多台DHCP服务器向DHCP客户机发来的信息，则DHCP客户机只接受第一个收到的DHCP offer提供信息，然后它就以广播方式向一个DHCP request请求信息，将选择某台DHCP服务器所提供的IP地址。
4. 确认阶段，即DHCP服务器确认所提供的IP地址的阶段。当DHCP服务器收到DHCP客户机回答的DHCP request请求信息之后，它便向DHCP客户机发送一个包含它所提供的IP地址和其他设置的DHCP ack确认信息，告诉DHCP客户机可以使用它所提供的IP地址。
5. 重新登录。以后DHCP客户机每次重新登录网络时，就不需要再发送DHCP discover发现信息了，而是直接发送包含前一次所分配的IP地址的DHCP request请求信息。当DHCP服务器收到这一信息后，它会尝试让DHCP客户机继续使用原来的IP地址，并回答一个DHCP ack确认信息。如果此IP地址已无法再分配给原来的DHCP客户机使用时（比如此IP地址已分配给其它DHCP客户机使用），则DHCP服务器给DHCP客户机回答一个DHCP nack否认信息。当原来的DHCP客户机收到此DHCP nack否认信息后，它就必须重新发送DHCP discover发现信息来请求新的IP地址。
6. 更新租约。DHCP服务器向DHCP客户机出租的IP地址一般都有一个租借期限，期满后DHCP服务器便会收回出租的IP地址。如果DHCP客户机要延长其IP租约，则必须更新其IP租约。DHCP客户机启动时和IP租约期限过一半时，DHCP客户机都会自动向DHCP服务器发送更新其IP租约的信息